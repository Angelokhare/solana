import{a as e,c as t,d as n,i as r,l as i,n as a,o,r as s,s as c,t as l,u}from"./index-BlB0zXgd.js";var d,f=new Uint8Array(16);function p(){if(!d&&(d=typeof crypto<`u`&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!d))throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);return d(f)}var m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));function h(e,t=0){return m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+`-`+m[e[t+4]]+m[e[t+5]]+`-`+m[e[t+6]]+m[e[t+7]]+`-`+m[e[t+8]]+m[e[t+9]]+`-`+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]}var g={randomUUID:typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function _(e,t,n){if(g.randomUUID&&!t&&!e)return g.randomUUID();e||={};let r=e.random||(e.rng||p)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n||=0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return h(r)}var v=_,y=n(l());t(),u();function b(e){return e.version===void 0}function x(e){return b(e)?e.serialize({verifySignatures:!1,requireAllSignatures:!1}):e.serialize()}var S=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})};function C(e){return S(this,void 0,void 0,function*(){try{return yield e.request({method:`wallet_getSnaps`}),!0}catch{return!1}})}function w(){return S(this,void 0,void 0,function*(){try{let e=window.ethereum;if(!e)return null;if(e.providers&&Array.isArray(e.providers)){let t=e.providers;for(let e of t)if(yield C(e))return e}if(e.detected&&Array.isArray(e.detected)){let t=e.detected;for(let e of t)if(yield C(e))return e}return(yield C(e))?e:null}catch(e){return console.error(e),null}})}const T=[`solana:mainnet`,`solana:devnet`,`solana:testnet`,`solana:localnet`];function E(e){return T.includes(e)}var D=function(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)},O=function(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n},k,A,j,M,N,P,F=T,I=[r,a,s],L=class e{get address(){return D(this,k,`f`)}get publicKey(){return D(this,A,`f`).slice()}get chains(){return D(this,j,`f`).slice()}get features(){return D(this,M,`f`).slice()}get label(){return D(this,N,`f`)}get icon(){return D(this,P,`f`)}constructor({address:t,publicKey:n,label:r,icon:i}){k.set(this,void 0),A.set(this,void 0),j.set(this,void 0),M.set(this,void 0),N.set(this,void 0),P.set(this,void 0),new.target===e&&Object.freeze(this),O(this,k,t,`f`),O(this,A,n,`f`),O(this,j,F,`f`),O(this,M,I,`f`),O(this,N,r,`f`),O(this,P,i,`f`)}};k=new WeakMap,A=new WeakMap,j=new WeakMap,M=new WeakMap,N=new WeakMap,P=new WeakMap;var R=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},z=class t extends i{constructor(e){super(),this._network=`mainnet-beta`,this._iframeParams={},this._element=null,this._iframe=null,this._publicKey=null,this._account=null,this._isConnected=!1,this._connectHandler=null,this._messageHandlers={},this._handleEvent=e=>{switch(e.type){case`connect`:this._collapseIframe(),e.data?.publicKey?(this._publicKey=e.data.publicKey,this._isConnected=!0,this._connectHandler&&=(this._connectHandler.resolve(),null),this._connected()):(this._connectHandler&&=(this._connectHandler.reject(),null),this._disconnected());return;case`disconnect`:this._connectHandler&&=(this._connectHandler.reject(),null),this._disconnected();return;case`accountChanged`:e.data?.publicKey?(this._publicKey=e.data.publicKey,this.emit(`accountChanged`,this.publicKey),this._standardConnected()):(this.emit(`accountChanged`,void 0),this._standardDisconnected());return;default:return}},this._handleResize=e=>{e.resizeMode===`full`?e.params.mode===`fullscreen`?this._expandIframe():e.params.mode===`hide`&&this._collapseIframe():e.resizeMode===`coordinates`&&this._resizeIframe(e.params)},this._handleMessage=e=>{if(e.data?.channel!==`solflareIframeToWalletAdapter`)return;let t=e.data.data||{};if(t.type===`event`)this._handleEvent(t.event);else if(t.type===`resize`)this._handleResize(t);else if(t.type===`response`&&this._messageHandlers[t.id]){let{resolve:e,reject:n}=this._messageHandlers[t.id];delete this._messageHandlers[t.id],t.error?n(t.error):e(t.result)}},this._removeElement=()=>{this._element&&=(this._element.remove(),null)},this._removeDanglingElements=()=>{let e=document.getElementsByClassName(`solflare-metamask-wallet-adapter-iframe`);for(let t of e)t.parentElement&&t.remove()},this._injectElement=()=>{this._removeElement(),this._removeDanglingElements();let e=Object.assign(Object.assign({},this._iframeParams),{mm:!0,v:1,cluster:this._network||`mainnet-beta`,origin:window.location.origin||``,title:document.title||``}),n=Object.keys(e).map(t=>`${t}=${encodeURIComponent(e[t])}`).join(`&`),r=`${t.IFRAME_URL}?${n}`;this._element=document.createElement(`div`),this._element.className=`solflare-metamask-wallet-adapter-iframe`,this._element.innerHTML=`
      <iframe src='${r}' style='position: fixed; top: 0; bottom: 0; left: 0; right: 0; width: 100%; height: 100%; border: none; border-radius: 0; z-index: 99999; color-scheme: auto;' allowtransparency='true'></iframe>
    `,document.body.appendChild(this._element),this._iframe=this._element.querySelector(`iframe`),window.addEventListener(`message`,this._handleMessage,!1)},this._collapseIframe=()=>{this._iframe&&(this._iframe.style.top=``,this._iframe.style.right=``,this._iframe.style.height=`2px`,this._iframe.style.width=`2px`)},this._expandIframe=()=>{this._iframe&&(this._iframe.style.top=`0px`,this._iframe.style.bottom=`0px`,this._iframe.style.left=`0px`,this._iframe.style.right=`0px`,this._iframe.style.width=`100%`,this._iframe.style.height=`100%`)},this._resizeIframe=e=>{this._iframe&&(this._iframe.style.top=isFinite(e.top)?`${e.top}px`:``,this._iframe.style.bottom=isFinite(e.bottom)?`${e.bottom}px`:``,this._iframe.style.left=isFinite(e.left)?`${e.left}px`:``,this._iframe.style.right=isFinite(e.right)?`${e.right}px`:``,this._iframe.style.width=isFinite(e.width)?`${e.width}px`:e.width,this._iframe.style.height=isFinite(e.height)?`${e.height}px`:e.height)},this._sendIframeMessage=e=>{if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);return new Promise((t,n)=>{var r;let i=v();this._messageHandlers[i]={resolve:t,reject:n},(r=this._iframe?.contentWindow)==null||r.postMessage({channel:`solflareWalletAdapterToIframe`,data:Object.assign({id:i},e)},`*`)})},this._connected=()=>{this._isConnected=!0,this.emit(`connect`,this.publicKey),this._standardConnected()},this._disconnected=()=>{this._publicKey=null,this._isConnected=!1,window.removeEventListener(`message`,this._handleMessage,!1),this._removeElement(),this.emit(`disconnect`),this._standardDisconnected()},this._standardConnected=()=>{if(!this.publicKey)return;let e=this.publicKey.toString();(!this._account||this._account.address!==e)&&(this._account=new L({address:e,publicKey:this.publicKey.toBytes()}),this.emit(`standard_change`,{accounts:this.standardAccounts}))},this._standardDisconnected=()=>{this._account&&(this._account=null,this.emit(`standard_change`,{accounts:this.standardAccounts}))},e?.network&&(this._network=e?.network),window.SolflareMetaMaskParams&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),window.SolflareMetaMaskParams)),e?.params&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),e?.params))}get publicKey(){return this._publicKey?new e(this._publicKey):null}get standardAccount(){return this._account}get standardAccounts(){return this._account?[this._account]:[]}get isConnected(){return this._isConnected}get connected(){return this.isConnected}get autoApprove(){return!1}connect(){return R(this,void 0,void 0,function*(){this.connected||(this._injectElement(),yield new Promise((e,t)=>{this._connectHandler={resolve:e,reject:t}}))})}disconnect(){return R(this,void 0,void 0,function*(){yield this._sendIframeMessage({method:`disconnect`}),this._disconnected()})}signTransaction(e){return R(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let t=x(e),{transaction:n}=yield this._sendIframeMessage({method:`signTransactionV2`,params:{transaction:y.default.encode(t)}});return b(e)?o.from(y.default.decode(n)):c.deserialize(y.default.decode(n))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign transaction`)}})}signAllTransactions(e){return R(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let t=e.map(e=>x(e)),{transactions:n}=yield this._sendIframeMessage({method:`signAllTransactionsV2`,params:{transactions:t.map(e=>y.default.encode(e))}});return n.map((t,n)=>b(e[n])?o.from(y.default.decode(t)):c.deserialize(y.default.decode(t)))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign transactions`)}})}signAndSendTransaction(e,t){return R(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let n=x(e),{signature:r}=yield this._sendIframeMessage({method:`signAndSendTransaction`,params:{transaction:y.default.encode(n),options:t}});return r}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign and send transaction`)}})}signMessage(e,t=`utf8`){return R(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let{signature:n}=yield this._sendIframeMessage({method:`signMessage`,params:{data:y.default.encode(e),display:t}});return Uint8Array.from(y.default.decode(n))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign message`)}})}sign(e,t=`utf8`){return R(this,void 0,void 0,function*(){return yield this.signMessage(e,t)})}static isSupported(){return R(this,void 0,void 0,function*(){return!!(yield w())})}standardSignAndSendTransaction(...e){return R(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let t=[];if(e.length===1){let{transaction:n,account:r,chain:i,options:a}=e[0],{minContextSlot:o,preflightCommitment:s,skipPreflight:l,maxRetries:u}=a||{};if(r!==this._account)throw Error(`invalid account`);if(!E(i))throw Error(`invalid chain`);let d=yield this.signAndSendTransaction(c.deserialize(n),{preflightCommitment:s,minContextSlot:o,maxRetries:u,skipPreflight:l});t.push({signature:y.default.decode(d)})}else if(e.length>1)for(let n of e)t.push(...yield this.standardSignAndSendTransaction(n));return t})}standardSignTransaction(...e){return R(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let t=[];if(e.length===1){let{transaction:n,account:r,chain:i}=e[0];if(r!==this._account)throw Error(`invalid account`);if(i&&!E(i))throw Error(`invalid chain`);let a=yield this.signTransaction(c.deserialize(n));t.push({signedTransaction:a.serialize()})}else if(e.length>1){let n;for(let t of e){if(t.account!==this._account)throw Error(`invalid account`);if(t.chain){if(!E(t.chain))throw Error(`invalid chain`);if(n){if(t.chain!==n)throw Error(`conflicting chain`)}else n=t.chain}}let r=e.map(({transaction:e})=>c.deserialize(e)),i=yield this.signAllTransactions(r);t.push(...i.map(e=>({signedTransaction:e.serialize()})))}return t})}standardSignMessage(...e){return R(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let t=[];if(e.length===1){let{message:n,account:r}=e[0];if(r!==this._account)throw Error(`invalid account`);let i=yield this.signMessage(n);t.push({signedMessage:n,signature:i})}else if(e.length>1)for(let n of e)t.push(...yield this.standardSignMessage(n));return t})}};z.IFRAME_URL=`https://widget.solflare.com/`;var B=z;export{B as default};